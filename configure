#! /bin/sh

# Try to turn internationalization off
unset LANG
unset LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES LC_MONETARY LC_NUMERIC LC_TIME

set -e

for i in "$@"; do
  case $i in
    --bindir=*)
      BINDIR=${i##*=}
      ;;
    *)
      echo "usage: ./configure [--bindir=<dir>] [--libdir=<dir>] [--pkgdir=<dir>]" 1>&2
      exit 2
      ;;
  esac
done

# OCaml is already installed, this means we should have everything we
# need. Just dump its configuration.

ocamlc -config | sed 's/: /="/;s/$/"/' > config.sh
ocamlc -config | sed 's/^/let /;s/: / = "/;s/$/"/' > myocamlbuild_config.ml

# Add a few things to config.sh

. ./config.sh

if [ "$os_type" = Win32 ]; then
    ext_exe=".exe"
else
    ext_exe=""
fi

OCAMLC="`which ocamlc`"
BINDIR="${BINDIR:-`dirname $OCAMLC`}"

cat >> config.sh <<EOF
A="$ext_lib"
O="$ext_obj"
EXE="$ext_exe"
BINDIR="$BINDIR"
EOF

OCAMLFIND_DESTDIR=`ocamlfind printconf destdir`
cat >> myocamlbuild_config.ml <<EOF
let ocamlfind_destdir = "$OCAMLFIND_DESTDIR"
EOF
